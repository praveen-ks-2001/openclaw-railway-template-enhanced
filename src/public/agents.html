<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü¶û OpenClaw ‚Äî Agents Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style type="text/tailwindcss">
    @theme {
      --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
      --color-surface: #09090b;
      --color-surface-raised: rgba(255, 255, 255, 0.03);
      --color-surface-overlay: rgba(255, 255, 255, 0.06);
      --color-border: rgba(255, 255, 255, 0.07);
      --color-border-muted: rgba(255, 255, 255, 0.04);
      --color-accent: #e63946;
      --color-accent-hover: #f04d5a;
      --color-text-primary: #fafafa;
      --color-text-secondary: #a1a1aa;
      --color-text-muted: #52525b;
      --color-success: #22c55e;
      --color-warning: #eab308;
      --color-danger: #ef4444;
    }
    [x-cloak] { display: none !important; }
    body { background: var(--color-surface); }

    body::before {
      content: ''; position: fixed; top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, rgba(230,57,70,0.3), transparent);
      z-index: 100; pointer-events: none;
    }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.14); }

    .card {
      background: var(--color-surface-raised);
      border: 1px solid var(--color-border-muted);
      border-radius: 18px; padding: 24px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover {
      border-color: var(--color-border);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.02), 0 8px 32px rgba(0,0,0,0.12);
    }

    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 12px; border-radius: 999px; font-size: 12px; font-weight: 500;
    }
    .badge-success { background: rgba(34,197,94,0.1); color: #4ade80; border: 1px solid rgba(34,197,94,0.15); }
    .badge-warning { background: rgba(234,179,8,0.1); color: #facc15; border: 1px solid rgba(234,179,8,0.15); }
    .badge-danger  { background: rgba(239,68,68,0.1); color: #f87171; border: 1px solid rgba(239,68,68,0.15); }
    .badge-muted   { background: rgba(255,255,255,0.04); color: #a1a1aa; border: 1px solid rgba(255,255,255,0.06); }
    .badge-accent  { background: rgba(230,57,70,0.1); color: #f04d5a; border: 1px solid rgba(230,57,70,0.15); }

    .pulse-dot {
      width: 8px; height: 8px; border-radius: 50%;
    }
    .pulse-dot.green  { background: #22c55e; box-shadow: 0 0 8px rgba(34,197,94,0.4); }
    .pulse-dot.yellow { background: #eab308; box-shadow: 0 0 8px rgba(234,179,8,0.4); animation: pulse 2s infinite; }
    .pulse-dot.red    { background: #ef4444; box-shadow: 0 0 8px rgba(239,68,68,0.4); }
    .pulse-dot.gray   { background: #52525b; }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { animation: spin 1s linear infinite; }

    /* Agent avatar ring */
    @keyframes ring-rotate { to { transform: rotate(360deg); } }
    @keyframes ring-pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    .agent-ring-active {
      animation: ring-rotate 8s linear infinite;
    }
    .agent-ring-pulse {
      animation: ring-pulse 3s ease-in-out infinite;
    }

    /* Flowing connection line */
    @keyframes flow {
      0% { stroke-dashoffset: 20; }
      100% { stroke-dashoffset: 0; }
    }
    .flow-line {
      stroke-dasharray: 5,5;
      animation: flow 1s linear infinite;
    }

    .file-tree { font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace; font-size: 13px; }
    .file-tree-item { padding: 3px 0; display: flex; align-items: center; gap: 8px; }
    .file-tree-item:hover { color: var(--color-text-primary); }
    .stat-value { font-size: 28px; font-weight: 700; letter-spacing: -0.02em; line-height: 1; }
    .stat-label { font-size: 12px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; }
  </style>
</head>

<body class="font-sans text-[var(--color-text-secondary)] min-h-screen antialiased">
<div x-data="agentsDashboard()" x-init="init()" class="max-w-6xl mx-auto px-4 sm:px-6 py-8">

  <!-- Header -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold text-[var(--color-text-primary)] flex items-center gap-3">
        <span class="text-3xl">ü¶û</span>
        Agents Dashboard
      </h1>
      <p class="text-sm mt-1 text-[var(--color-text-muted)]">
        Visual overview of your OpenClaw agents, channels &amp; system
      </p>
    </div>
    <div class="flex items-center gap-3">
      <a href="/setup" class="text-sm text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] transition-colors px-3 py-1.5 rounded-lg border border-[var(--color-border-muted)] hover:border-[var(--color-border)]">
        ‚Üê Setup
      </a>
      <button @click="refresh()" :disabled="loading"
        class="text-sm text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] transition-colors px-3 py-1.5 rounded-lg border border-[rgba(230,57,70,0.15)] hover:border-[rgba(230,57,70,0.3)] disabled:opacity-50">
        <span x-show="!loading">‚Üª Refresh</span>
        <span x-show="loading" class="flex items-center gap-2">
          <svg class="w-3.5 h-3.5 spinner" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/></svg>
          Loading‚Ä¶
        </span>
      </button>
    </div>
  </div>

  <!-- Error banner -->
  <div x-show="error" x-cloak class="mb-6 p-4 rounded-xl bg-[rgba(239,68,68,0.08)] border border-[rgba(239,68,68,0.15)] text-sm text-[#f87171]">
    <span x-text="error"></span>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MAIN AGENT VISUAL ‚Äî big hero card with avatar + status
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="card mb-8 relative overflow-hidden">
    <!-- Subtle gradient bg -->
    <div class="absolute inset-0 opacity-30 pointer-events-none"
         style="background: radial-gradient(ellipse at 30% 20%, rgba(230,57,70,0.08) 0%, transparent 60%);"></div>

    <div class="relative flex flex-col lg:flex-row gap-8 items-start lg:items-center">

      <!-- Agent Avatar -->
      <div class="flex flex-col items-center gap-3 min-w-[160px]">
        <div class="relative">
          <!-- Outer animated ring -->
          <svg class="w-28 h-28" :class="gatewayOk ? 'agent-ring-active' : ''" viewBox="0 0 120 120">
            <defs>
              <linearGradient id="ringGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" :stop-color="gatewayOk ? '#22c55e' : '#52525b'" stop-opacity="0.8"/>
                <stop offset="50%" :stop-color="gatewayOk ? '#4ade80' : '#71717a'" stop-opacity="0.2"/>
                <stop offset="100%" :stop-color="gatewayOk ? '#22c55e' : '#52525b'" stop-opacity="0.8"/>
              </linearGradient>
            </defs>
            <circle cx="60" cy="60" r="55" fill="none" stroke="url(#ringGrad)" stroke-width="2"
                    stroke-dasharray="8,4" :class="gatewayOk ? '' : ''" />
          </svg>
          <!-- Inner circle with emoji -->
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-20 h-20 rounded-full flex items-center justify-center text-4xl"
                 :class="gatewayOk ? 'bg-[rgba(34,197,94,0.08)] border-2 border-[rgba(34,197,94,0.2)]'
                                    : 'bg-[rgba(82,82,91,0.15)] border-2 border-[rgba(82,82,91,0.2)]'">
              ü¶û
            </div>
          </div>
        </div>
        <div class="text-center">
          <div class="text-[15px] font-bold text-[var(--color-text-primary)]">Main Agent</div>
          <template x-if="gatewayOk">
            <span class="badge badge-success mt-1"><span class="pulse-dot green"></span> Running</span>
          </template>
          <template x-if="status.gateway?.starting && !gatewayOk">
            <span class="badge badge-warning mt-1"><span class="pulse-dot yellow"></span> Starting</span>
          </template>
          <template x-if="!gatewayOk && !status.gateway?.starting">
            <span class="badge badge-danger mt-1"><span class="pulse-dot red"></span> Offline</span>
          </template>
        </div>
      </div>

      <!-- Agent Details -->
      <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-3 text-sm">
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Primary Model</span>
          <div class="text-[var(--color-text-primary)] font-semibold mt-0.5"
               x-text="overview.agents?.model?.primary || overview.model || '(default)'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Workspace</span>
          <div class="text-[var(--color-text-primary)] font-mono text-xs mt-0.5"
               x-text="overview.agents?.workspace || '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Max Concurrent</span>
          <div class="text-[var(--color-text-primary)] font-semibold mt-0.5"
               x-text="overview.agents?.maxConcurrent ?? '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Subagent Concurrency</span>
          <div class="text-[var(--color-text-primary)] font-semibold mt-0.5"
               x-text="overview.agents?.subagents?.maxConcurrent ?? '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Compaction</span>
          <div class="text-[var(--color-text-primary)] mt-0.5"
               x-text="overview.agents?.compaction?.mode || '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Version</span>
          <div class="text-[var(--color-text-primary)] font-mono text-xs mt-0.5"
               x-text="overview.openclawVersion || '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Session Scope</span>
          <div class="text-[var(--color-text-primary)] mt-0.5"
               x-text="overview.session?.dmScope || '‚Äî'"></div>
        </div>
        <div>
          <span class="text-[var(--color-text-muted)] text-xs uppercase tracking-wider">Memory (RSS)</span>
          <div class="text-[var(--color-text-primary)] font-mono text-xs mt-0.5"
               x-text="formatBytes(status.memory?.rss)"></div>
        </div>
      </div>

      <!-- Model aliases sidebar -->
      <div class="lg:border-l lg:border-[var(--color-border-muted)] lg:pl-8 min-w-[160px]">
        <div class="text-xs text-[var(--color-text-muted)] uppercase tracking-wider mb-3">Models</div>
        <div class="space-y-2">
          <template x-for="(cfg, id) in (overview.agents?.models || {})" :key="id">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-[var(--color-accent)]"></span>
              <div>
                <div class="text-xs text-[var(--color-text-primary)] font-medium" x-text="cfg.alias || id"></div>
                <div class="text-[11px] text-[var(--color-text-muted)] font-mono" x-text="id"></div>
              </div>
            </div>
          </template>
          <template x-if="Object.keys(overview.agents?.models || {}).length === 0">
            <span class="text-xs text-[var(--color-text-muted)] italic">No model aliases</span>
          </template>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CHANNEL AGENTS ‚Äî visual cards with connection lines
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="mb-8">
    <div class="flex items-center gap-3 mb-5">
      <h2 class="text-lg font-bold text-[var(--color-text-primary)]">Channel Agents</h2>
      <span class="badge badge-muted" x-text="channelCount + ' connected'"></span>
    </div>

    <template x-if="channelCount === 0">
      <div class="card text-center py-14">
        <p class="text-5xl mb-4">üì≠</p>
        <p class="text-[var(--color-text-muted)]">No channels configured yet.</p>
        <a href="/setup" class="inline-block mt-3 text-sm text-[var(--color-accent)] hover:text-[var(--color-accent-hover)]">Go to Setup ‚Üí</a>
      </div>
    </template>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5">
      <template x-for="(cfg, name) in (overview.channels || {})" :key="name">
        <div class="card !p-0 overflow-hidden group">
          <!-- Channel header with colored accent -->
          <div class="p-5 pb-4 relative">
            <!-- Top accent bar -->
            <div class="absolute top-0 left-0 right-0 h-[3px]"
                 :style="'background: ' + channelColor(name)"></div>

            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center gap-4">
                <!-- Channel Avatar -->
                <div class="relative">
                  <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-2xl transition-transform group-hover:scale-105"
                       :style="'background: ' + channelColor(name) + '15; border: 1px solid ' + channelColor(name) + '30'">
                    <span x-text="channelIcon(name)"></span>
                  </div>
                  <!-- Status pip -->
                  <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center"
                       :class="cfg.enabled ? 'bg-[rgba(34,197,94,0.15)] border border-[rgba(34,197,94,0.3)]'
                                            : 'bg-[rgba(82,82,91,0.2)] border border-[rgba(82,82,91,0.3)]'">
                    <span class="pulse-dot" :class="cfg.enabled && gatewayOk ? 'green' : (cfg.enabled ? 'yellow' : 'gray')"
                          style="width:8px;height:8px;"></span>
                  </div>
                </div>

                <div>
                  <h3 class="text-base font-bold text-[var(--color-text-primary)] capitalize" x-text="name"></h3>
                  <template x-if="cfg.enabled && gatewayOk">
                    <span class="text-xs text-[#4ade80] font-medium">‚óè Active ‚Äî Listening</span>
                  </template>
                  <template x-if="cfg.enabled && !gatewayOk">
                    <span class="text-xs text-[#facc15] font-medium">‚óè Enabled ‚Äî Gateway Down</span>
                  </template>
                  <template x-if="!cfg.enabled">
                    <span class="text-xs text-[var(--color-text-muted)] font-medium">‚óã Disabled</span>
                  </template>
                </div>
              </div>
            </div>

            <!-- Channel properties -->
            <div class="grid grid-cols-2 gap-x-6 gap-y-2">
              <template x-for="(val, key) in channelDetails(cfg)" :key="key">
                <div class="flex flex-col">
                  <span class="text-[10px] text-[var(--color-text-muted)] uppercase tracking-wider" x-text="key"></span>
                  <span class="text-xs text-[var(--color-text-secondary)] font-medium" x-text="String(val)"></span>
                </div>
              </template>
            </div>
          </div>

          <!-- Bottom bar -->
          <div class="px-5 py-3 bg-[var(--color-surface-overlay)] border-t border-[var(--color-border-muted)] flex items-center justify-between">
            <span class="text-[11px] text-[var(--color-text-muted)]">
              Credentials: <span :class="cfg.hasToken ? 'text-[#4ade80]' : 'text-[#f87171]'"
                                  x-text="cfg.hasToken ? '‚úì Present' : '‚úó Missing'"></span>
            </span>
            <template x-if="cfg.enabled && gatewayOk">
              <span class="badge badge-success !py-0.5 !text-[10px]">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Live
              </span>
            </template>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SUBAGENTS VISUAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="card mb-8" x-show="overview.agents?.maxConcurrent">
    <div class="flex items-center gap-3 mb-5">
      <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">ü§ñ</div>
      <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Agent Slots</h2>
      <span class="text-xs text-[var(--color-text-muted)]">Concurrency pool visualization</span>
    </div>

    <!-- Main agent slots -->
    <div class="mb-5">
      <div class="text-xs text-[var(--color-text-muted)] uppercase tracking-wider mb-3">
        Main Agents <span class="text-[var(--color-text-primary)] font-semibold" x-text="'(' + (overview.agents?.maxConcurrent || 0) + ' max)'"></span>
      </div>
      <div class="flex flex-wrap gap-3">
        <template x-for="i in (overview.agents?.maxConcurrent || 0)" :key="'main-'+i">
          <div class="relative group/slot">
            <div class="w-14 h-14 rounded-xl border-2 flex items-center justify-center text-lg transition-all"
                 :class="i === 1 && gatewayOk
                   ? 'bg-[rgba(34,197,94,0.06)] border-[rgba(34,197,94,0.25)] text-[#4ade80]'
                   : 'bg-[var(--color-surface-overlay)] border-[var(--color-border-muted)] text-[var(--color-text-muted)]'">
              <template x-if="i === 1 && gatewayOk">
                <span>ü¶û</span>
              </template>
              <template x-if="!(i === 1 && gatewayOk)">
                <span class="text-sm font-mono opacity-40" x-text="'#' + i"></span>
              </template>
            </div>
            <!-- Tooltip -->
            <div class="absolute -top-8 left-1/2 -translate-x-1/2 px-2.5 py-1 rounded-lg bg-[#27272a] text-[10px] text-[var(--color-text-primary)] font-medium whitespace-nowrap opacity-0 group-hover/slot:opacity-100 transition-opacity pointer-events-none z-10">
              <span x-text="i === 1 && gatewayOk ? 'Primary ‚Äî Active' : 'Slot #' + i + ' ‚Äî Idle'"></span>
            </div>
          </div>
        </template>
      </div>
    </div>

    <!-- Subagent slots -->
    <div>
      <div class="text-xs text-[var(--color-text-muted)] uppercase tracking-wider mb-3">
        Sub-agents <span class="text-[var(--color-text-primary)] font-semibold" x-text="'(' + (overview.agents?.subagents?.maxConcurrent || 0) + ' max)'"></span>
      </div>
      <div class="flex flex-wrap gap-2">
        <template x-for="i in (overview.agents?.subagents?.maxConcurrent || 0)" :key="'sub-'+i">
          <div class="relative group/slot">
            <div class="w-10 h-10 rounded-lg border flex items-center justify-center text-xs transition-all bg-[var(--color-surface-overlay)] border-[var(--color-border-muted)] text-[var(--color-text-muted)]">
              <span class="font-mono opacity-40" x-text="'s' + i"></span>
            </div>
            <div class="absolute -top-8 left-1/2 -translate-x-1/2 px-2.5 py-1 rounded-lg bg-[#27272a] text-[10px] text-[var(--color-text-primary)] font-medium whitespace-nowrap opacity-0 group-hover/slot:opacity-100 transition-opacity pointer-events-none z-10">
              <span x-text="'Subagent slot #' + i + ' ‚Äî Idle'"></span>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       COMPACT INFO GRID: Gateway / Devices / Commands / Skills
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">

    <!-- Gateway & System -->
    <div class="card">
      <div class="flex items-center gap-3 mb-5">
        <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">‚ö°</div>
        <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Gateway</h2>
        <div class="ml-auto">
          <template x-if="gatewayOk">
            <span class="badge badge-success"><span class="pulse-dot green"></span> Running</span>
          </template>
          <template x-if="status.gateway?.starting">
            <span class="badge badge-warning"><span class="pulse-dot yellow"></span> Starting</span>
          </template>
          <template x-if="!gatewayOk && !status.gateway?.starting">
            <span class="badge badge-danger"><span class="pulse-dot red"></span> Offline</span>
          </template>
        </div>
      </div>
      <div class="space-y-3 text-sm">
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">PID</span><span class="text-[var(--color-text-primary)] font-mono text-xs" x-text="status.gateway?.pid || '‚Äî'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Reachable</span><span :class="status.gateway?.reachable ? 'text-[#4ade80]' : 'text-[var(--color-text-muted)]'" x-text="status.gateway?.reachable ? 'Yes' : 'No'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Node.js</span><span class="text-[var(--color-text-primary)] font-mono text-xs" x-text="status.nodeVersion || '‚Äî'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Uptime</span><span class="text-[var(--color-text-primary)]" x-text="formatUptime(status.uptime)"></span></div>
      </div>
    </div>

    <!-- Devices -->
    <div class="card">
      <div class="flex items-center gap-3 mb-5">
        <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">üì±</div>
        <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Paired Devices</h2>
        <span class="badge badge-muted ml-auto" x-text="deviceCount + ' device(s)'"></span>
      </div>
      <template x-if="deviceCount === 0">
        <p class="text-sm text-[var(--color-text-muted)] italic">No devices paired or gateway not running.</p>
      </template>
      <div class="space-y-2">
        <template x-for="(dev, i) in (status.devices || [])" :key="i">
          <div class="flex items-center justify-between p-3 rounded-xl bg-[var(--color-surface-overlay)]">
            <div class="flex items-center gap-3">
              <span>üíª</span>
              <div>
                <div class="text-sm font-medium text-[var(--color-text-primary)]" x-text="dev.name || dev.id || ('Device ' + (i+1))"></div>
                <div class="text-xs text-[var(--color-text-muted)]" x-text="dev.type || dev.status || ''"></div>
              </div>
            </div>
            <template x-if="dev.connected || dev.status === 'connected'">
              <span class="badge badge-success"><span class="pulse-dot green"></span> Connected</span>
            </template>
            <template x-if="dev.status === 'pending'">
              <span class="badge badge-warning"><span class="pulse-dot yellow"></span> Pending</span>
            </template>
            <template x-if="!dev.connected && dev.status !== 'connected' && dev.status !== 'pending'">
              <span class="badge badge-muted" x-text="dev.status || 'Unknown'"></span>
            </template>
          </div>
        </template>
      </div>
    </div>

    <!-- Commands & Skills -->
    <div class="card">
      <div class="flex items-center gap-3 mb-5">
        <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">‚öôÔ∏è</div>
        <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Commands &amp; Skills</h2>
      </div>
      <div class="space-y-3 text-sm">
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Native commands</span><span class="text-[var(--color-text-primary)]" x-text="overview.commands?.native || '‚Äî'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Native skills</span><span class="text-[var(--color-text-primary)]" x-text="overview.commands?.nativeSkills || '‚Äî'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Restart allowed</span><span :class="overview.commands?.restart ? 'text-[#4ade80]' : 'text-[var(--color-text-muted)]'" x-text="overview.commands?.restart ? 'Yes' : 'No'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">Skill node manager</span><span class="text-[var(--color-text-primary)]" x-text="overview.skills?.install?.nodeManager || '‚Äî'"></span></div>
        <div class="flex justify-between"><span class="text-[var(--color-text-muted)]">ACK scope</span><span class="text-[var(--color-text-primary)]" x-text="overview.messages?.ackReactionScope || '‚Äî'"></span></div>
      </div>
    </div>

    <!-- Auth Providers -->
    <div class="card">
      <div class="flex items-center gap-3 mb-5">
        <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">üîë</div>
        <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Auth Providers</h2>
      </div>
      <template x-if="Object.keys(overview.auth || {}).length === 0">
        <p class="text-sm text-[var(--color-text-muted)] italic">No auth providers in config.</p>
      </template>
      <div class="space-y-2">
        <template x-for="(cfg, name) in (overview.auth || {})" :key="name">
          <div class="flex items-center justify-between p-3 rounded-xl bg-[var(--color-surface-overlay)]">
            <div class="flex items-center gap-3">
              <span class="text-base" x-text="providerIcon(name)"></span>
              <div class="text-sm font-medium text-[var(--color-text-primary)] capitalize" x-text="name"></div>
            </div>
            <span class="badge badge-success">Configured</span>
          </div>
        </template>
      </div>
      <template x-if="overview.configKeys && overview.configKeys.length > 0">
        <div class="mt-4 pt-3 border-t border-[var(--color-border-muted)]">
          <p class="text-[10px] text-[var(--color-text-muted)] uppercase tracking-wider mb-2">Config sections</p>
          <div class="flex flex-wrap gap-1.5">
            <template x-for="key in overview.configKeys" :key="key">
              <span class="text-[11px] font-mono px-2 py-0.5 rounded-md bg-[var(--color-surface-overlay)] text-[var(--color-text-muted)]" x-text="key"></span>
            </template>
          </div>
        </div>
      </template>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FILESYSTEM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="card mb-6">
    <div class="flex items-center gap-3 mb-5">
      <div class="w-9 h-9 rounded-xl bg-[rgba(230,57,70,0.08)] flex items-center justify-center text-lg">üìÇ</div>
      <h2 class="text-base font-semibold text-[var(--color-text-primary)]">Service Filesystem</h2>
      <button @click="showFs = !showFs"
        class="ml-auto text-xs text-[var(--color-text-muted)] hover:text-[var(--color-text-secondary)] transition-colors">
        <span x-text="showFs ? '‚ñæ Collapse' : '‚ñ∏ Expand'"></span>
      </button>
    </div>

    <div class="flex flex-col sm:flex-row gap-4 mb-4 text-sm">
      <div class="flex items-center gap-2">
        <span class="text-[var(--color-text-muted)]">State:</span>
        <span class="font-mono text-xs text-[var(--color-text-secondary)]" x-text="fsData.stateDir?.path || '‚Äî'"></span>
        <span class="badge badge-muted !text-[10px]" x-text="formatBytes(fsData.stateDir?.totalSize)"></span>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-[var(--color-text-muted)]">Workspace:</span>
        <span class="font-mono text-xs text-[var(--color-text-secondary)]" x-text="fsData.workspaceDir?.path || '‚Äî'"></span>
        <span class="badge badge-muted !text-[10px]" x-text="formatBytes(fsData.workspaceDir?.totalSize)"></span>
      </div>
    </div>

    <div x-show="showFs" x-cloak x-transition class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <h3 class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-3">State Directory</h3>
        <div class="file-tree text-[var(--color-text-secondary)] space-y-0.5">
          <template x-if="!fsData.stateDir?.entries?.length"><p class="text-[var(--color-text-muted)] italic text-xs">Empty or unavailable</p></template>
          <template x-for="entry in (fsData.stateDir?.entries || [])" :key="entry.name">
            <div>
              <div class="file-tree-item">
                <span x-text="entry.type === 'directory' ? 'üìÅ' : 'üìÑ'" class="text-xs"></span>
                <span x-text="entry.name"></span>
                <span x-show="entry.size !== undefined" class="text-[var(--color-text-muted)] text-[11px] ml-auto" x-text="formatBytes(entry.size)"></span>
              </div>
              <template x-if="entry.children && entry.children.length > 0">
                <div class="ml-6 border-l border-[var(--color-border-muted)] pl-3">
                  <template x-for="child in entry.children" :key="child.name">
                    <div class="file-tree-item">
                      <span x-text="child.type === 'directory' ? 'üìÅ' : 'üìÑ'" class="text-xs"></span>
                      <span x-text="child.name"></span>
                      <span x-show="child.size !== undefined" class="text-[var(--color-text-muted)] text-[11px] ml-auto" x-text="formatBytes(child.size)"></span>
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>
      <div>
        <h3 class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wider mb-3">Workspace Directory</h3>
        <div class="file-tree text-[var(--color-text-secondary)] space-y-0.5">
          <template x-if="!fsData.workspaceDir?.entries?.length"><p class="text-[var(--color-text-muted)] italic text-xs">Empty or unavailable</p></template>
          <template x-for="entry in (fsData.workspaceDir?.entries || [])" :key="entry.name">
            <div>
              <div class="file-tree-item">
                <span x-text="entry.type === 'directory' ? 'üìÅ' : 'üìÑ'" class="text-xs"></span>
                <span x-text="entry.name"></span>
                <span x-show="entry.size !== undefined" class="text-[var(--color-text-muted)] text-[11px] ml-auto" x-text="formatBytes(entry.size)"></span>
              </div>
              <template x-if="entry.children && entry.children.length > 0">
                <div class="ml-6 border-l border-[var(--color-border-muted)] pl-3">
                  <template x-for="child in entry.children" :key="child.name">
                    <div class="file-tree-item">
                      <span x-text="child.type === 'directory' ? 'üìÅ' : 'üìÑ'" class="text-xs"></span>
                      <span x-text="child.name"></span>
                      <span x-show="child.size !== undefined" class="text-[var(--color-text-muted)] text-[11px] ml-auto" x-text="formatBytes(child.size)"></span>
                    </div>
                  </template>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="text-center text-xs text-[var(--color-text-muted)] pb-8">
    Auto-refreshes every 30s ¬∑ <span x-text="lastRefresh"></span>
  </div>

</div>

<script>
function agentsDashboard() {
  return {
    loading: false,
    error: null,
    overview: {},
    status: {},
    fsData: {},
    showFs: false,
    lastRefresh: '',
    _interval: null,

    async init() {
      await this.refresh();
      this._interval = setInterval(() => this.refresh(), 30000);
    },

    async httpJson(url) {
      const res = await fetch(url, { credentials: 'same-origin' });
      if (!res.ok) {
        const t = await res.text();
        throw new Error('HTTP ' + res.status + ': ' + (t || res.statusText));
      }
      return res.json();
    },

    async refresh() {
      this.loading = true;
      this.error = null;
      try {
        const [overview, status, fsData] = await Promise.all([
          this.httpJson('/agents/api/overview'),
          this.httpJson('/agents/api/status'),
          this.httpJson('/agents/api/filesystem'),
        ]);
        this.overview = overview;
        this.status = status;
        this.fsData = fsData;
        this.lastRefresh = new Date().toLocaleTimeString();
      } catch (err) {
        this.error = err.message;
      } finally {
        this.loading = false;
      }
    },

    get channelCount() {
      return Object.keys(this.overview.channels || {}).length;
    },
    get deviceCount() {
      return Array.isArray(this.status.devices) ? this.status.devices.length : 0;
    },
    get gatewayOk() {
      return this.status.gateway?.running && this.status.gateway?.reachable;
    },

    channelIcon(name) {
      const map = { telegram: '‚úàÔ∏è', discord: 'üéÆ', slack: 'üí¨', whatsapp: 'üì±', matrix: 'üîó', irc: 'üíª' };
      return map[name.toLowerCase()] || 'üì°';
    },
    channelColor(name) {
      const map = { telegram: '#2AABEE', discord: '#5865F2', slack: '#E01E5A', whatsapp: '#25D366', matrix: '#0DBD8B', irc: '#A970FF' };
      return map[name.toLowerCase()] || '#e63946';
    },
    providerIcon(name) {
      const map = { openai: 'ü§ñ', anthropic: 'üß†', google: 'üîç', openrouter: 'üåê', copilot: 'üêô', moonshot: 'üåô', qwen: 'üå∏', minimax: '‚ö°', synthetic: 'üß™', gemini: 'üíé', profiles: 'üîë' };
      return map[name.toLowerCase()] || 'üîë';
    },
    channelDetails(cfg) {
      const skip = new Set(['enabled', 'hasToken', 'token', 'botToken', 'appToken']);
      const out = {};
      for (const [k, v] of Object.entries(cfg)) {
        if (skip.has(k)) continue;
        if (typeof v === 'object') continue;
        out[k] = v;
      }
      return out;
    },
    formatBytes(bytes) {
      if (bytes === undefined || bytes === null) return '‚Äî';
      if (bytes === 0) return '0 B';
      const units = ['B', 'KB', 'MB', 'GB'];
      const i = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);
      return (bytes / Math.pow(1024, i)).toFixed(i === 0 ? 0 : 1) + ' ' + units[i];
    },
    formatUptime(seconds) {
      if (!seconds) return '‚Äî';
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      if (h > 0) return h + 'h ' + m + 'm';
      if (m > 0) return m + 'm';
      return Math.floor(seconds) + 's';
    },
  };
}
</script>
</body>
</html>
